{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/eriki/Documents/GitHub/amplify-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { r as registerInstance, h } from './index-83f2275b.js';\nimport { Logger, filenameToContentType, I18n } from '@aws-amplify/core';\nimport { A as AccessLevel } from './storage-types-f257c0f2.js';\nimport '@aws-amplify/auth';\nimport { T as Translations } from './Translations-c833f663.js';\nimport { d as NO_STORAGE_MODULE_FOUND } from './constants-c8ecaa24.js';\nimport { Storage } from '@aws-amplify/storage';\nimport { i as imageFileType, c as calcKey, p as putStorageObject } from './storage-helpers-1afafead.js'; // Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\n\nfunction rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}\n\nconst REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0; // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nconst amplifyS3AlbumCss = \":host{--overlay-bg-color:rgba(0, 0, 0, 0.15)}.album-container{-webkit-box-sizing:border-box;box-sizing:border-box;max-width:100%;margin:0 auto;padding:0 2rem}.grid-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:-1rem -1rem;padding-bottom:3rem}.grid-item{position:relative;-ms-flex:1 0 22rem;flex:1 0 22rem;-ms-flex-positive:1;flex-grow:1;margin:1rem;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}amplify-s3-image{--width:22rem;--height:20rem;border-radius:5px;-o-object-fit:cover;object-fit:cover}.img-overlay{display:none;width:100%;height:21rem;position:absolute;top:0;left:0;background-color:var(--overlay-bg-color)}.grid-item:hover .img-overlay{display:block}\";\nconst logger = new Logger('S3Album');\nconst AmplifyS3Album = class {\n  constructor(hostRef) {\n    var _this = this;\n\n    registerInstance(this, hostRef);\n    /** The content type header used when uploading to S3 */\n\n    this.contentType = 'binary/octet-stream';\n    /** The access level of the files */\n\n    this.level = AccessLevel.Public;\n    /** Boolean to enable or disable picker */\n\n    this.picker = true;\n    /** Picker button text */\n\n    this.pickerText = Translations.PICKER_TEXT;\n    this.albumItems = [];\n    this.imgArr = {};\n    this.list = /*#__PURE__*/_asyncToGenerator(function* () {\n      const {\n        path = '',\n        level,\n        track,\n        identityId\n      } = _this;\n      logger.debug('Album path: ' + path);\n\n      if (!Storage || typeof Storage.list !== 'function') {\n        throw new Error(NO_STORAGE_MODULE_FOUND);\n      }\n\n      try {\n        const data = yield Storage.list(path, {\n          level,\n          track,\n          identityId\n        });\n\n        _this.marshal(data);\n      } catch (error) {\n        logger.warn(error);\n      }\n    });\n\n    this.marshal = list => {\n      list.forEach(item => {\n        const name = item.key.toLowerCase();\n        const ext = name.split('.')[1];\n\n        if (imageFileType.has(ext)) {\n          if (!item.contentType || item.contentType && item.contentType === 'binary/octet-stream') {\n            item.contentType = this.getContentType(item);\n          }\n        }\n      });\n      const filtered = list.filter(item => item.contentType && item.contentType.startsWith('image/'));\n      let items = this.filter ? this.filter(filtered) : filtered;\n      items = this.sort ? this.sort(items) : items;\n      this.albumItems = items;\n      logger.debug('album items', this.albumItems);\n      this.constructImgArray(this.albumItems);\n    };\n\n    this.constructImgArray = list => {\n      list.map(item => {\n        this.imgArr[`${item['key']}`] = item['key'];\n      });\n    };\n\n    this.handlePick = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(function* (event) {\n        const file = event.target.files[0];\n        const {\n          path = '',\n          level,\n          track,\n          fileToKey\n        } = _this;\n        const key = path + calcKey(file, fileToKey);\n\n        try {\n          yield putStorageObject(key, file, level, track, file['type'], logger);\n        } catch (error) {\n          logger.error(error);\n          throw new Error(error);\n        }\n\n        if (Object.keys(_this.imgArr).includes(key)) {\n          _this.albumItems = [..._this.albumItems];\n          _this.imgArr[key] = `${key}-${v4()}`;\n        } else {\n          const filtered = [..._this.albumItems, ...(_this.filter ? _this.filter([{\n            key\n          }]) : [{\n            key\n          }])];\n          _this.albumItems = _this.sort ? _this.sort(filtered) : filtered;\n        }\n      });\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  }\n\n  getContentType(item) {\n    return filenameToContentType(item.key, 'image/*');\n  }\n\n  componentWillLoad() {\n    this.list();\n  }\n\n  render() {\n    return h(\"div\", null, h(\"div\", {\n      class: \"album-container\"\n    }, h(\"div\", {\n      class: \"grid-row\"\n    }, this.albumItems.map(item => {\n      return h(\"div\", {\n        class: \"grid-item\",\n        key: `key-${item.key}`\n      }, h(\"amplify-s3-image\", {\n        key: this.imgArr[item.key],\n        imgKey: item.key,\n        level: this.level,\n        path: this.path,\n        identityId: this.identityId,\n        track: this.track,\n        handleOnError: this.handleOnError,\n        handleOnLoad: this.handleOnLoad\n      }), h(\"span\", {\n        class: \"img-overlay\"\n      }));\n    }))), this.picker && h(\"amplify-picker\", {\n      pickerText: I18n.get(this.pickerText),\n      inputHandler: e => this.handlePick(e),\n      acceptValue: \"image/*\"\n    }));\n  }\n\n};\nAmplifyS3Album.style = amplifyS3AlbumCss;\nexport { AmplifyS3Album as amplify_s3_album };","map":{"version":3,"sources":["C:/Users/eriki/Documents/GitHub/amplify-app/node_modules/@aws-amplify/ui-components/dist/esm/amplify-s3-album.entry.js"],"names":["r","registerInstance","h","Logger","filenameToContentType","I18n","A","AccessLevel","T","Translations","d","NO_STORAGE_MODULE_FOUND","Storage","i","imageFileType","c","calcKey","p","putStorageObject","getRandomValues","rnds8","Uint8Array","rng","crypto","bind","msCrypto","Error","REGEX","validate","uuid","test","byteToHex","push","toString","substr","stringify","arr","offset","arguments","length","undefined","toLowerCase","TypeError","v4","options","buf","rnds","random","amplifyS3AlbumCss","logger","AmplifyS3Album","constructor","hostRef","contentType","level","Public","picker","pickerText","PICKER_TEXT","albumItems","imgArr","list","path","track","identityId","debug","data","marshal","error","warn","forEach","item","name","key","ext","split","has","getContentType","filtered","filter","startsWith","items","sort","constructImgArray","map","handlePick","event","file","target","files","fileToKey","Object","keys","includes","componentWillLoad","render","class","imgKey","handleOnError","handleOnLoad","get","inputHandler","e","acceptValue","style","amplify_s3_album"],"mappings":"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","sourcesContent":["import { r as registerInstance, h } from './index-83f2275b.js';\nimport { Logger, filenameToContentType, I18n } from '@aws-amplify/core';\nimport { A as AccessLevel } from './storage-types-f257c0f2.js';\nimport '@aws-amplify/auth';\nimport { T as Translations } from './Translations-c833f663.js';\nimport { d as NO_STORAGE_MODULE_FOUND } from './constants-c8ecaa24.js';\nimport { Storage } from '@aws-amplify/storage';\nimport { i as imageFileType, c as calcKey, p as putStorageObject } from './storage-helpers-1afafead.js';\n\n// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nfunction rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}\n\nconst REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nconst amplifyS3AlbumCss = \":host{--overlay-bg-color:rgba(0, 0, 0, 0.15)}.album-container{-webkit-box-sizing:border-box;box-sizing:border-box;max-width:100%;margin:0 auto;padding:0 2rem}.grid-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:-1rem -1rem;padding-bottom:3rem}.grid-item{position:relative;-ms-flex:1 0 22rem;flex:1 0 22rem;-ms-flex-positive:1;flex-grow:1;margin:1rem;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}amplify-s3-image{--width:22rem;--height:20rem;border-radius:5px;-o-object-fit:cover;object-fit:cover}.img-overlay{display:none;width:100%;height:21rem;position:absolute;top:0;left:0;background-color:var(--overlay-bg-color)}.grid-item:hover .img-overlay{display:block}\";\n\nconst logger = new Logger('S3Album');\nconst AmplifyS3Album = class {\n    constructor(hostRef) {\n        registerInstance(this, hostRef);\n        /** The content type header used when uploading to S3 */\n        this.contentType = 'binary/octet-stream';\n        /** The access level of the files */\n        this.level = AccessLevel.Public;\n        /** Boolean to enable or disable picker */\n        this.picker = true;\n        /** Picker button text */\n        this.pickerText = Translations.PICKER_TEXT;\n        this.albumItems = [];\n        this.imgArr = {};\n        this.list = async () => {\n            const { path = '', level, track, identityId } = this;\n            logger.debug('Album path: ' + path);\n            if (!Storage || typeof Storage.list !== 'function') {\n                throw new Error(NO_STORAGE_MODULE_FOUND);\n            }\n            try {\n                const data = await Storage.list(path, {\n                    level,\n                    track,\n                    identityId,\n                });\n                this.marshal(data);\n            }\n            catch (error) {\n                logger.warn(error);\n            }\n        };\n        this.marshal = (list) => {\n            list.forEach((item) => {\n                const name = item.key.toLowerCase();\n                const ext = name.split('.')[1];\n                if (imageFileType.has(ext)) {\n                    if (!item.contentType ||\n                        (item.contentType && item.contentType === 'binary/octet-stream')) {\n                        item.contentType = this.getContentType(item);\n                    }\n                }\n            });\n            const filtered = list.filter((item) => item.contentType && item.contentType.startsWith('image/'));\n            let items = this.filter ? this.filter(filtered) : filtered;\n            items = this.sort ? this.sort(items) : items;\n            this.albumItems = items;\n            logger.debug('album items', this.albumItems);\n            this.constructImgArray(this.albumItems);\n        };\n        this.constructImgArray = (list) => {\n            list.map(item => {\n                this.imgArr[`${item['key']}`] = item['key'];\n            });\n        };\n        this.handlePick = async (event) => {\n            const file = event.target.files[0];\n            const { path = '', level, track, fileToKey } = this;\n            const key = path + calcKey(file, fileToKey);\n            try {\n                await putStorageObject(key, file, level, track, file['type'], logger);\n            }\n            catch (error) {\n                logger.error(error);\n                throw new Error(error);\n            }\n            if (Object.keys(this.imgArr).includes(key)) {\n                this.albumItems = [...this.albumItems];\n                this.imgArr[key] = `${key}-${v4()}`;\n            }\n            else {\n                const filtered = [\n                    ...this.albumItems,\n                    ...(this.filter ? this.filter([{ key }]) : [{ key }]),\n                ];\n                this.albumItems = this.sort ? this.sort(filtered) : filtered;\n            }\n        };\n    }\n    getContentType(item) {\n        return filenameToContentType(item.key, 'image/*');\n    }\n    componentWillLoad() {\n        this.list();\n    }\n    render() {\n        return (h(\"div\", null, h(\"div\", { class: \"album-container\" }, h(\"div\", { class: \"grid-row\" }, this.albumItems.map(item => {\n            return (h(\"div\", { class: \"grid-item\", key: `key-${item.key}` }, h(\"amplify-s3-image\", { key: this.imgArr[item.key], imgKey: item.key, level: this.level, path: this.path, identityId: this.identityId, track: this.track, handleOnError: this.handleOnError, handleOnLoad: this.handleOnLoad }), h(\"span\", { class: \"img-overlay\" })));\n        }))), this.picker && (h(\"amplify-picker\", { pickerText: I18n.get(this.pickerText), inputHandler: e => this.handlePick(e), acceptValue: \"image/*\" }))));\n    }\n};\nAmplifyS3Album.style = amplifyS3AlbumCss;\n\nexport { AmplifyS3Album as amplify_s3_album };\n"]},"metadata":{},"sourceType":"module"}